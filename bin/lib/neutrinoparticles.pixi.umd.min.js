!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("pixi.js"),require("neutrinoparticles.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js","neutrinoparticles.js"],b):b((a=a||self).PIXINeutrino={},a.PIXI,a.Neutrino)}(this,function(exports,PIXI$1,Neutrino){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(o,p)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){return call&&("object"==typeof call||"function"==typeof call)?call:_assertThisInitialized(self)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(d,b,e){var c=_superPropBase(d,b);if(c){var a=Object.getOwnPropertyDescriptor(c,b);return a.get?a.get.call(e):a.value}})(target,property,receiver||target)}var Context=function(){function a(b,c){_classCallCheck(this,a),this.options=Object.assign({texturesBasePath:"",trimmedExtensionsLookupFirst:!0},c),this.neutrino=new Neutrino.Context,this.canvasRenderer=!!PIXI$1.CanvasRenderer&&b instanceof PIXI$1.CanvasRenderer,this._noiseInitialized=!1,this._noiseGenerator=null}return _createClass(a,[{key:"initializeNoise",value:function(b,a,c){if(this._noiseInitialized){a&&a();return}this.neutrino.initializeNoise(b,function(){this._noiseInitialized=!0,a&&a()},c)}},{key:"generateNoise",value:function(){if(!this._noiseInitialized){for(var a=new this.neutrino.NoiseGenerator;!a.step(););this._noiseInitialized=!0}}},{key:"generateNoiseStep",value:function(){if(this._noiseInitialized)return{done:!0,progress:1};this._noiseGenerator||(this._noiseGenerator=new this.neutrino.NoiseGenerator);var a=this._noiseGenerator.step(),b=this._noiseGenerator.progress;return a&&(this._noiseInitialized=!0,this._noiseGenerator=null),{done:a,progress:b}}},{key:"loadOptions",get:function(){return{metadata:{neutrino:this}}}}]),a}(),ApplicationPlugin=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"init",value:function(a){this.neutrino=new Context(this.renderer,a.neutrino||{})}},{key:"destroy",value:function(){this.neutrino=null}}]),a}(),RendererPlugin=function(b){function a(c){var b;return _classCallCheck(this,a),(b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,c))).options=Object.assign({maxBatchVertices:16384,maxBatchTextures:PIXI$1.settings.SPRITE_MAX_TEXTURES,canUploadSameBuffer:PIXI$1.settings.CAN_UPLOAD_SAME_BUFFER},c.options.neutrino||{}),b.shaderGenerator=new PIXI$1.BatchShaderGenerator(PIXI$1.BatchPluginFactory.defaultVertexSrc,PIXI$1.BatchPluginFactory.defaultFragmentTemplate),b.geometryClass=PIXI$1.BatchGeometry,b.vertexSize=6,b.state=PIXI$1.State.for2d(),b.maxVertices=b.options.maxBatchVertices,b.maxIndices=b.maxVertices/4*6,b._vertexCount=0,b._indexCount=0,b._shader=null,b._packedGeometries=[],b._packedGeometryPoolSize=2,b._flushId=0,b.MAX_TEXTURES=1,b.renderer.on("prerender",b.onPrerender,_assertThisInitialized(b)),c.runners.contextChange.add(_assertThisInitialized(b)),b._dcIndex=0,b._aIndex=0,b._iIndex=0,b._attributeBuffer=new PIXI$1.ViewableBuffer(b.maxVertices*b.vertexSize*4),b._indexBuffer=new Uint16Array(b.maxIndices),b._drawCallPool=[],b._textureArrayPool=[],b._indices=[0,1,3,1,2,3],b._texArrayTick=0,b}return _inherits(a,b),_createClass(a,[{key:"contextChange",value:function(){var a=this.renderer.gl;PIXI$1.settings.PREFER_ENV===PIXI$1.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),this.options.maxBatchTextures),this.MAX_TEXTURES=PIXI$1.checkMaxIfStatementsInShader(this.MAX_TEXTURES,a)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var b=0;b<this._packedGeometryPoolSize;b++)this._packedGeometries[b]=new this.geometryClass;for(var c=this.maxVertices/4,d=Math.floor(c/this.MAX_TEXTURES)+1;this._drawCallPool.length<c;)this._drawCallPool.push(new PIXI$1.BatchDrawCall);for(;this._textureArrayPool.length<d;)this._textureArrayPool.push(new Array)}},{key:"onPrerender",value:function(){this._flushId=0,this._flushReset()}},{key:"render",value:function(e,d,c){if(this.renderer.batch,d.valid){(this._vertexCount+4>this.maxVertices||this._indexCount+6>this.maxIndices)&&this.flush(),this._vertexCount+=4,this._indexCount+=6;var f=this.MAX_TEXTURES,a=d.baseTexture;c=PIXI$1.utils.premultiplyBlendMode[a.alphaMode?1:0][c];var g=this.renderer.textureGC.count,b=this._textureArrayPool[this._countTexArrays-1];if(a._neutrinoTick!==this._texArrayTick){b.length>=f&&(b=this._textureArrayPool[this._countTexArrays++],++this._texArrayTick);var h=b.length;a._neutrinoTick=this._texArrayTick,a._neutrinoBatchLocation=h,a.touched=g,b.push(a)}this.packInterleavedGeometry(e,this._attributeBuffer,this._indexBuffer,this._aIndex,this._iIndex,a._neutrinoBatchLocation,a.alphaMode!=PIXI$1.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA),this._pushDrawCall(c,b,4*this.vertexSize,6)}}},{key:"flush",value:function(){0!==this._vertexCount&&this._flush()}},{key:"start",value:function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),this.options.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}},{key:"stop",value:function(){this.flush()}},{key:"destroy",value:function(){for(var b=0;b<this._packedGeometryPoolSize;b++)this._packedGeometries[b]&&this._packedGeometries[b].destroy();this.renderer.off("prerender",this.onPrerender,this),this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),_get(_getPrototypeOf(a.prototype),"destroy",this).call(this)}},{key:"packInterleavedGeometry",value:function(c,f,g,a,h,i,j){for(var k=f.uint32View,d=f.float32View,l=a/this.vertexSize,m=j?function(a){var b=a[3];if(0==b)return 0;if(255==b)return a[0]|a[1]<<8|a[2]<<16|b<<24;var c=b/255;return a[0]*c|a[1]*c<<8|a[2]*c<<16|b<<24}:function(a){return a[0]|a[1]<<8|a[2]<<16|a[3]<<24},b=0;b<4;++b)d[a++]=c[b].position[0],d[a++]=c[b].position[1],d[a++]=c[b].texCoords[0],d[a++]=1-c[b].texCoords[1],k[a++]=m(c[b].color),d[a++]=i;for(var e=0;e<this._indices.length;e++)g[h++]=l+this._indices[e]}},{key:"_pushDrawCall",value:function(b,c,e,d){var a=this._drawCallPool[this._dcIndex];(a.blend!==b||a.texArray!==c)&&(a.size>0&&(a=this._drawCallPool[++this._dcIndex]),a.size=0,a.start=this._iIndex,a.texArray=c,a.blend=b),a.size+=d,this._aIndex+=e,this._iIndex+=d}},{key:"_bindAndClearTexArray",value:function(b){for(var c=this.renderer.texture,a=0;a<b.length;a++)c.bind(b[a],a),b[a]=null;b.length=0}},{key:"_updateGeometry",value:function(){var a=this._packedGeometries,b=this._attributeBuffer,c=this._indexBuffer;this.options.canUploadSameBuffer?(a[this._flushId]._buffer.update(b.rawBinaryData),a[this._flushId]._indexBuffer.update(c),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,a[this._flushId]=new this.geometryClass),a[this._flushId]._buffer.update(b.rawBinaryData),a[this._flushId]._indexBuffer.update(c),this.renderer.geometry.bind(a[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}},{key:"_drawBatches",value:function(){for(var g=this._dcIndex,d=this.renderer,e=d.gl,h=d.state,i=this._drawCallPool,f=null,b=0;b<g;b++){var a=i[b],c=a.texArray,j=a.type,k=a.size,l=a.start,m=a.blend;f!==c&&(f=c,this._bindAndClearTexArray(c)),this.state.blendMode=m,h.set(this.state),e.drawElements(j,k,e.UNSIGNED_SHORT,2*l)}}},{key:"_flush",value:function(){this._drawCallPool[this._dcIndex].size>0&& ++this._dcIndex,this._updateGeometry(),this._drawBatches(),this._flushReset()}},{key:"_flushReset",value:function(){this._countTexArrays=1,this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._vertexCount=0,this._indexCount=0;var a=this._drawCallPool[0];a.start=0,a.texArray=this._textureArrayPool[0],a.blend=null,a.size=0,++this._texArrayTick}}]),a}(PIXI$1.ObjectRenderer),EffectModel=function(_PIXI$utils$EventEmit){function EffectModel(context,neutrinoModel,texturesLoader){if(_classCallCheck(this,EffectModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(EffectModel).call(this))).ctx=context,"string"==typeof neutrinoModel){var _this,evalScript="(function(ctx) {\n"+neutrinoModel+"\nreturn new NeutrinoEffect(ctx);\n})(context.neutrino);";_this.effectModel=eval(evalScript)}else _this.effectModel=neutrinoModel;_this.texturesRemap=null,_this.textures=[],_this.textureImageDescs=[];var numTextures=_this.effectModel.textures.length;_this._numTexturesToLoadLeft=numTextures;for(var imageIndex=0;imageIndex<numTextures;++imageIndex){var texturePath=_this.effectModel.textures[imageIndex],texture=null;if(_this.ctx.options.trimmedExtensionsLookupFirst){var trimmedTexturePath=texturePath.replace(/\.[^/.]+$/,"");texture=PIXI$1.utils.TextureCache[trimmedTexturePath]}texture||(texture=PIXI$1.utils.TextureCache[texturePath]),texture?texture.baseTexture.valid?_this._onTextureLoaded(imageIndex,texture):texture.once("update",function(a,b,c){return function(){a._onTextureLoaded(b,c)}}(_assertThisInitialized(_this),imageIndex,texture)):texturesLoader.load(_this.ctx.options.texturesBasePath+texturePath,function(a,b){return function(c){a._onTextureLoaded(b,c)}}(_assertThisInitialized(_this),imageIndex))}return _this}return _inherits(EffectModel,_PIXI$utils$EventEmit),_createClass(EffectModel,[{key:"ready",value:function(){return 0===this._numTexturesToLoadLeft}},{key:"_onTextureLoaded",value:function(b,a){if(this.textures[b]=a,this._numTexturesToLoadLeft--,this.ctx.canvasRenderer){var c=a.baseTexture.resource.source;this.textureImageDescs[b]=new this.ctx.neutrino.ImageDesc(c,a.orig.x,a.orig.y,a.orig.width,a.orig.height)}0===this._numTexturesToLoadLeft&&(this.ctx.canvasRenderer||this._initTexturesRemapIfNeeded(),this.emit("ready",this))}},{key:"_initTexturesRemapIfNeeded",value:function(){for(var e=!1,d=0;d<this.textures.length;++d){var b=this.textures[d];if(0!=b.orig.x||0!=b.orig.y||b.orig.width!=b.baseTexture.realWidth||b.orig.height!=b.baseTexture.realHeight){e=!0;break}}if(this.texturesRemap=[],e)for(var c=0;c<this.textures.length;++c){var a=this.textures[c];this.texturesRemap[c]=new this.ctx.neutrino.SubRect(a.orig.x/a.baseTexture.realWidth,1-(a.orig.y+a.orig.height)/a.baseTexture.realHeight,a.orig.width/a.baseTexture.realWidth,a.orig.height/a.baseTexture.realHeight)}}}]),EffectModel}(PIXI$1.utils.EventEmitter),AbstractTexturesLoader=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"load",value:function(a,b){}}]),a}(),PIXITexturesLoader=function(){function a(){_classCallCheck(this,a),this._pixiLoader=null,this._parentResource=null}return _createClass(a,[{key:"setPIXILoader",value:function(a){this._pixiLoader=a}},{key:"setParentResource",value:function(a){this._parentResource=a}},{key:"load",value:function(a,b){this._pixiLoader.add(a,{parentResource:this._parentResource},function(a){b(a.texture)})}}]),a}(),_pixiTexturesLoader=new PIXITexturesLoader,LoaderPlugin=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"use",value:function(a,b){"js"===a.extension&&a.metadata&&a.metadata.neutrino&&a.data&&(_pixiTexturesLoader.setPIXILoader(this),_pixiTexturesLoader.setParentResource(a),a.effectModel=new EffectModel(a.metadata.neutrino,a.data,_pixiTexturesLoader)),b()}}]),a}(),Pause=Object.freeze({NO:Symbol(0),BEFORE_UPDATE_OR_RENDER:Symbol(1),YES:Symbol(2)}),_tempV3=[0,0,0],QuadBuffer=function(){function a(c,d){function b(){this.position=[0,0],this.color=[0,0,0,0],this.texCoords=[0,0]}_classCallCheck(this,a),this.worldTransform=[0,0,0,0,0,0],this.worldAlpha=1,this._pushQuadCallback=c,this._vertices=[new b,new b,new b,new b],this._currentVertex=0,this._renderStyle=0,this._projection=d,this._quadDiscarded=!1}return _createClass(a,[{key:"initialize",value:function(a,b,c,d){}},{key:"beforeQuad",value:function(a){this._renderStyle=a,this._quadDiscarded=!1}},{key:"pushVertex",value:function(a){var b=this._vertices[this._currentVertex],c=this.worldTransform,d=a.position[0],e=a.position[1];_tempV3[0]=c[0]*d+c[2]*e+c[4],_tempV3[1]=c[1]*d+c[3]*e+c[5],this._projection?(_tempV3[2]=a.position[2],this._quadDiscarded|=!this._projection.transformPosition(b.position,_tempV3)):(b.position[0]=_tempV3[0],b.position[1]=_tempV3[1]),b.color[0]=a.color[0],b.color[1]=a.color[1],b.color[2]=a.color[2],b.color[3]=a.color[3]*this.worldAlpha,b.texCoords[0]=a.texCoords[0][0],b.texCoords[1]=a.texCoords[0][1],++this._currentVertex,4==this._currentVertex&&(this._quadDiscarded||this._pushQuadCallback(this._vertices,this._renderStyle),this._currentVertex=0)}},{key:"pushRenderCall",value:function(a){}},{key:"cleanup",value:function(){}}]),a}(),_cancamPoint0=new PIXI$1.Point(0,0),_cancamPoint1=new PIXI$1.Point(0,0),_cancamPoint2=new PIXI$1.Point(0,0),_cancamArray0=[0,0,0],_rencanMatrix0=new PIXI$1.Matrix,Effect=function(b){function a(d,c,e,f,g){var b;if(_classCallCheck(this,a),b=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this)),c instanceof Array&&(c={position:c,rotation:e||0,scale:f||[1,1,1],baseParent:g||null}),c=Object.assign({position:[0,0,0],rotation:0,scale:[1,1,1],pause:Pause.BEFORE_UPDATE_OR_RENDER,generatorsPaused:!1,baseParent:null,projection:null},c),b.ctx=d.ctx,b.effectModel=d,b.effect=null,b.baseParent=c.baseParent,b.position.set(c.position[0],c.position[1]),b.positionZ=c.position[2],b.rotation=c.rotation,b.scale.x=c.scale[0],b.scale.y=c.scale[1],b.scaleZ=c.scale[2],b._projection=c.projection,b._renderElements=[],b._startupOptions={paused:c.pause!==Pause.NO,generatorsPaused:c.generatorsPaused},b._unpauseOnUpdateRender=c.pause===Pause.BEFORE_UPDATE_OR_RENDER,d.ready()?b._onEffectReady():d.once("ready",function(){this._onEffectReady()},_assertThisInitialized(b)),b._updateWorldTransform(),d.ctx.canvasRenderer&&b._projection){var h=_assertThisInitialized(b);b._canvasCameraAdapter={matrix:null,transform:function(b,e){var c=_cancamPoint1,f=_cancamPoint0;f.x=b[0],f.y=b[1];var a=_cancamArray0,d=_cancamPoint2;this.matrix.apply(_cancamPoint0,c),a[0]=c.x,a[1]=c.y,a[2]=b[2];var g=h._projection.transformPosition(a,a);return this.matrix.applyInverse({x:a[0],y:a[1]},d),b[0]=d.x,b[1]=d.y,h._projection.transformSize(e,a,e),g}}}return b}return _inherits(a,b),_createClass(a,[{key:"ready",value:function(){return this._ready}},{key:"update",value:function(a){this.ready()&&(this._checkUnpauseOnUpdateRender(),this._updateWorldTransform(),null!=this.effect&&this.effect.update(a,this._scaledPosition(),this.ctx.neutrino.axisangle2quat_([0,0,1],this.worldRotationDegree)))}},{key:"restart",value:function(a,b){a&&(this.position.x=a[0],this.position.y=a[1],this.positionZ=a[2]),b&&(this.rotation=b),this._updateWorldTransform(),this.effect.restart(this._scaledPosition(),b?this.ctx.neutrino.axisangle2quat_([0,0,1],this.worldRotationDegree):null)}},{key:"resetPosition",value:function(a,b){a&&(this.position.x=a[0],this.position.y=a[1],this.positionZ=a[2]),b&&(this.rotation=b),this._updateWorldTransform(),this.effect.resetPosition(this._scaledPosition(),b?this.ctx.neutrino.axisangle2quat_([0,0,1],this.worldRotationDegree):null)}},{key:"pause",value:function(){this.ready()?this.effect.pauseAllEmitters():this._startupOptions.paused=!0}},{key:"unpause",value:function(){this.ready()?this.effect.unpauseAllEmitters():this._startupOptions.paused=!1}},{key:"pauseGenerators",value:function(){this.ready()?this.effect.pauseGeneratorsInAllEmitters():this._startupOptions.generatorsPaused=!0}},{key:"unpauseGenerators",value:function(){this.ready()?this.effect.unpauseGeneratorsInAllEmitters():this._startupOptions.generatorsPaused=!1}},{key:"setPropertyInAllEmitters",value:function(a,b){this.effect.setPropertyInAllEmitters(a,b)}},{key:"getNumParticles",value:function(){return this.effect.getNumParticles()}},{key:"_render",value:function(c){if(this.ready()){this._renderer=c,this._checkUnpauseOnUpdateRender(),this._projection&&this._projection.setScreenFrame&&this._projection.setScreenFrame(c.projection.destinationFrame),c.batch.setObjectRenderer(c.plugins.neutrino);var f=this.renderBuffers,a=f.worldTransform;if(this.baseParent){var d=this.worldScale.x,e=this.worldScale.y,b=this.baseParent.worldTransform;a[0]=b.a*d,a[1]=b.b*e,a[2]=b.c*d,a[3]=b.d*e,a[4]=b.tx*d,a[5]=b.ty*e}else a[0]=this.worldScale.x,a[1]=0,a[2]=0,a[3]=this.worldScale.y,a[4]=0,a[5]=0;f.worldAlpha=this.worldAlpha,this.effect.fillGeometryBuffers([1,0,0],[0,-1,0],[0,0,-1]),this._renderer=null}}},{key:"_renderCanvas",value:function(b){if(this.ready()){this._checkUnpauseOnUpdateRender();var a=_rencanMatrix0;this.baseParent?(this.baseParent.worldTransform.copyTo(a),a.scale(this.worldScale.x,this.worldScale.y),b.context.setTransform(a.a,a.b,a.c,a.d,a.tx,a.ty)):(a.set(this.worldScale.x,0,0,this.worldScale.y,0,0),b.context.setTransform(a.a,a.b,a.c,a.d,a.tx,a.ty)),this._projection&&(this._canvasCameraAdapter.matrix=a,this._projection.setScreenFrame&&this._projection.setScreenFrame(b.screen)),b.context.save(),b.context.globalAlpha=this.worldAlpha,this.effect.draw(b.context,this._canvasCameraAdapter),b.context.restore()}}},{key:"_scaledPosition",value:function(){return[this.worldPosition.x/this.worldScale.x,this.worldPosition.y/this.worldScale.y,this.positionZ/this.scaleZ]}},{key:"_updateWorldTransform",value:function(){var a,b,c=new PIXI$1.Point(0,0),d=new PIXI$1.Point(1,0),e=new PIXI$1.Point(0,1);this.baseParent?(this.worldPosition=this.baseParent.toLocal(c,this),a=this.baseParent.toLocal(d,this),b=this.baseParent.toLocal(e,this)):(this.worldPosition=this.toGlobal(c),a=this.toGlobal(d),b=this.toGlobal(e)),a.x-=this.worldPosition.x,a.y-=this.worldPosition.y,b.x-=this.worldPosition.x,b.y-=this.worldPosition.y,this.worldScale={x:Math.sqrt(a.x*a.x+a.y*a.y),y:Math.sqrt(b.x*b.x+b.y*b.y)},this.worldRotationDegree=this._calcWorldRotation(this)/Math.PI*180%360}},{key:"_calcWorldRotation",value:function(a){return a.parent&&a.parent!=this.baseParent?a.rotation+this._calcWorldRotation(a.parent):a.rotation}},{key:"_onEffectReady",value:function(){var a=this;this._updateWorldTransform(),this.effectModel.ctx.canvasRenderer?(this.effect=this.effectModel.effectModel.createCanvas2DInstance(this._scaledPosition(),this.ctx.neutrino.axisangle2quat_([0,0,1],this.worldRotationDegree),this._startupOptions),this.effect.textureDescs=this.effectModel.textureImageDescs):(this.renderBuffers=new QuadBuffer(function(b,c){a._pushQuad(b,c)},this._projection),this._updateWorldTransform(),this.effect=this.effectModel.effectModel.createWGLInstance(this._scaledPosition(),this.ctx.neutrino.axisangle2quat_([0,0,1],this.worldRotationDegree),this.renderBuffers,this._startupOptions),this.effect.texturesRemap=this.effectModel.texturesRemap),this._ready=!0,this.emit("ready",this)}},{key:"_checkUnpauseOnUpdateRender",value:function(){this._unpauseOnUpdateRender&&(this.resetPosition(),this.unpause(),this._unpauseOnUpdateRender=!1)}},{key:"_pushQuad",value:function(c,d){var a,b=this.effect.model.renderStyles[d],e=b.textureIndices[0],f=this.effectModel.textures[e],g=this.effect.model.materials[b.materialIndex];switch(g){default:a=PIXI$1.BLEND_MODES.NORMAL;break;case 1:a=PIXI$1.BLEND_MODES.ADD;break;case 2:a=PIXI$1.BLEND_MODES.MULTIPLY}this._renderer.plugins.neutrino.render(c,f,a)}}]),a}(PIXI$1.Container),PerspectiveProjection=function(){function a(b){_classCallCheck(this,a),this.horizontalAngle=b}return _createClass(a,[{key:"setScreenFrame",value:function(a){this._screenWidth=a.width,this._screenHeight=a.height,this._screenPosX=a.x+.5*a.width,this._screenPosY=a.y+.5*a.height,this._z=.5*this._screenWidth/this._angleTan,this._near=.99*this._z}},{key:"transformPosition",value:function(b,a){if(a[2]>this._near)return!1;var c=this._getScale(a);return b[0]=(a[0]-this._screenPosX)*c+this._screenPosX,b[1]=(a[1]-this._screenPosY)*c+this._screenPosY,!0}},{key:"transformSize",value:function(a,d,b){var c=this._getScale(d);a[0]=b[0]*c,a[1]=b[1]*c}},{key:"_getScale",value:function(a){return this._z/(this._z-a[2])}},{key:"horizontalAngle",set:function(a){this._horizontalAngle=a,this._angleTan=Math.tan(.5*a/180*Math.PI)}}]),a}();function registerPlugins(){PIXI.Application.registerPlugin(ApplicationPlugin),PIXI.Renderer.registerPlugin("neutrino",RendererPlugin),PIXI.Loader.registerPlugin(LoaderPlugin)}exports.AbstractTexturesLoader=AbstractTexturesLoader,exports.ApplicationPlugin=ApplicationPlugin,exports.Context=Context,exports.Effect=Effect,exports.EffectModel=EffectModel,exports.LoaderPlugin=LoaderPlugin,exports.PIXITexturesLoader=PIXITexturesLoader,exports.Pause=Pause,exports.PerspectiveProjection=PerspectiveProjection,exports.QuadBuffer=QuadBuffer,exports.RendererPlugin=RendererPlugin,exports.registerPlugins=registerPlugins,Object.defineProperty(exports,"__esModule",{value:!0})})