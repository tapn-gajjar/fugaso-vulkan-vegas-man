!function(b,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((b=b||self).Neutrino={})}(this,function(exports){"use strict";function Context(){var ctx=this;function colorCompToHex_(c){return c<16?"0"+c.toString(16):c.toString(16)}this.equalv3_=function(a,b){return a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2]},this.equalq_=function(a,b){return a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2]&&a[3]==b[3]},this.a=function(a,b,c){a[0]=b[0]+c[0],a[1]=b[1]+c[1]},this.b=function(a,b){return[a[0]+b[0],a[1]+b[1]]},this.y=function(a,b,c){a[0]=b[0]+c,a[1]=b[1]+c},this.z=function(a,b){return[a[0]+b,a[1]+b]},this.c=function(a,b,c){a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2]},this.d=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},this.C=function(a,b,c){a[0]=b[0]+c,a[1]=b[1]+c,a[2]=b[2]+c},this.D=function(a,b){return[a[0]+b,a[1]+b,a[2]+b]},this.addq=function(a,b,c){a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3]},this.addq_=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3]]},this.e=function(a,b,c){a[0]=b[0]-c[0],a[1]=b[1]-c[1]},this.f=function(a,b){return[a[0]-b[0],a[1]-b[1]]},this.A=function(a,b,c){a[0]=b[0]-c,a[1]=b[1]-c},this.B=function(a,b){return[a[0]-b,a[1]-b]},this.nf=function(a,b,c){a[0]=b-c[0],a[1]=b-c[1]},this.of=function(a,b){return[a-b[0],a-b[1]]},this.g=function(a,b,c){a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2]},this.h=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},this.E=function(a,b,c){a[0]=b[0]-c,a[1]=b[1]-c,a[2]=b[2]-c},this.F=function(a,b){return[a[0]-b,a[1]-b,a[2]-b]},this.rf=function(a,b,c){a[0]=b-c[0],a[1]=b-c[1],a[2]=b-c[2]},this.sf=function(a,b){return[a-b[0],a-b[1],a-b[2]]},this.i=function(a,b,c){a[0]=b[0]*c[0],a[1]=b[1]*c[1]},this.j=function(a,b){return[a[0]*b[0],a[1]*b[1]]},this.k=function(a,b,c){a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2]},this.l=function(a,b){return[a[0]*b[0],a[1]*b[1],a[2]*b[2]]},this.m=function(a,b,c){a[0]=b[0]/c[0],a[1]=b[1]/c[1]},this.n=function(a,b){return[a[0]/b[0],a[1]/b[1]]},this.o=function(a,b,c){a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2]},this.p=function(a,b){return[a[0]/b[0],a[1]/b[1],a[2]/b[2]]},this.H=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},this.dotq_=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},this.q=function(a,b,c){a[0]=b[0]*c,a[1]=b[1]*c},this.r=function(a,b){return[a[0]*b,a[1]*b]},this.s=function(a,b,c){a[0]=b[0]/c,a[1]=b[1]/c},this.t=function(a,b){return[a[0]/b,a[1]/b]},this.u=function(a,b,c){a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c},this.v=function(a,b){return[a[0]*b,a[1]*b,a[2]*b]},this.w=function(a,b,c){a[0]=b[0]/c,a[1]=b[1]/c,a[2]=b[2]/c},this.x=function(a,b){return[a[0]/b,a[1]/b,a[2]/b]},this.y=function(a,b,c){a[0]=b[0]+c,a[1]=b[1]+c},this.z=function(a,b){return[a[0]+b,a[1]+b]},this.A=function(a,b,c){a[0]=b[0]-c,a[1]=b[1]-c},this.B=function(a,b){return[a[0]-b,a[1]-b]},this.G=function(a,b){return a[0]*b[0]+a[1]*b[1]},this.H=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},this.I=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g},this.J=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return[d*h-e*g,e*f-c*h,c*g-d*f]},this.K=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},this.L=function(a){return a[0]*a[0]+a[1]*a[1]},this.M=function(b,a){ctx.q(b,a,1/ctx.K(a))},this.N=function(a){return ctx.r(a,1/ctx.K(a))},this.O=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},this.P=function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},this.Q=function(b,a){ctx.u(b,a,1/ctx.O(a))},this.R=function(a){return ctx.v(a,1/ctx.O(a))},this.S=function(a,b){a[0]=b[0],a[1]=b[1]},this.T=function(a,b){a[0]=b[0],a[1]=b[1],a[2]=b[2]},this.U=function(a,b){a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]},this.V=function(a,b,c){a[0]=b,a[1]=c},this.W=function(a,b,c,d){a[0]=b,a[1]=c,a[2]=d},this.X=function(a,b,c){return a+(b-a)*c},this.Y=function(b,a,c,d){b[0]=a[0]+(c[0]-a[0])*d,b[1]=a[1]+(c[1]-a[1])*d},this.Z=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c]},this.ab=function(b,a,c,d){b[0]=a[0]+(c[0]-a[0])*d,b[1]=a[1]+(c[1]-a[1])*d,b[2]=a[2]+(c[2]-a[2])*d},this.bb=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c,a[2]+(b[2]-a[2])*c]},this.slerpq=function(d,b,a,c){var e=ctx.dotq_(b,a),f=[];if(e<0?(ctx.negq(f,a),e=-e):ctx.U(f,a),1-e<Number.EPSILON)d[0]=ctx.X(b[0],a[0],c),d[1]=ctx.X(b[1],a[1],c),d[2]=ctx.X(b[2],a[2],c),d[3]=ctx.X(b[3],a[3],c);else{var g=ctx.acos_(e);ctx.mulqscalar(d,ctx.addq_(ctx.mulqscalar_(b,ctx.sin_((1-c)*g)),ctx.mulqscalar_(f,ctx.sin_(c*g))),1/ctx.sin_(g))}},this.slerpq_=function(b,c,d){var a=[];return slerpq(a,b,c,d),a},this.acos_=function(a){return Math.acos(a)},this.sin_=function(a){return Math.sin(a)},this.cos_=function(a){return Math.cos(a)},this.taus88=function(a){var b,c,d;a||(a=0),this.seed=function(a){a&=4294967295,b=a<2?a+2:a,c=a<8?a+8:a,d=a<16?a+16:a},this.rand=function(){var a=((b<<13^b)&4294967295)>>>19;return b=((4294967294&b)<<12^a)>>>0,a=((c<<2^c)&4294967295)>>>25,c=((4294967288&c)<<4^a)>>>0,a=((d<<3^d)&4294967295)>>>11,((b^c^(d=((4294967280&d)<<17^a)>>>0))>>>0)/4294967296},this.seed(a)},this.cb=function(a,b){this.randv2gen(a,b,function(){return Math.random()})},this.randv2gen=function(a,b,d){var c=d()*Math.PI*2;a[0]=b*ctx.cos_(c),a[1]=b*ctx.sin_(c)},this.db=function(a,b){this.randv3gen(a,b,function(){return Math.random()})},this.randv3gen=function(a,c,d){var e=d()*Math.PI*2,b=-1+2*d(),f=c*Math.sqrt(1-b*b);a[0]=f*ctx.cos_(e),a[1]=f*ctx.sin_(e),a[2]=c*b},this.yb=function(c,d,e,a,b){var f=d+b()*a[0],g=e+b()*a[1];ctx.V(c,f,g)},this.eb=function(b,a){ctx.V(-a[0],-a[1])},this.fb=function(a){return[-a[0],-a[1]]},this.gb=function(b,a){ctx.W(-a[0],-a[1],-a[2])},this.hb=function(a){return[-a[0],-a[1],-a[2]]},this.negq=function(a,b){a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3]},this.negq_=function(a){return[-a[0],-a[1],-a[2],-a[3]]},this.ib=function(a){return a/180*Math.PI},this.jb=function(a){return a/Math.PI*180},this.Ae=function(a){return a<0?-1:1},this.ob=function(b,c,d,a){var e=2*a[0]*a[0],f=2*a[1]*a[1],g=2*a[2]*a[2],h=2*a[0]*a[1],i=2*a[0]*a[2],j=2*a[1]*a[2],k=2*a[3]*a[2],l=2*a[3]*a[1],m=2*a[3]*a[0];b[0]=1-f-g,b[1]=h+k,b[2]=i-l,c[0]=h-k,c[1]=1-e-g,c[2]=j+m,d[0]=i+l,d[1]=j-m,d[2]=1-e-f},this.pb=function(b,c,d,e){var f=c[0]+d[1]+e[2];if(f>0){var a=2*Math.sqrt(f+1);b[3]=.25*a,b[0]=(d[2]-e[1])/a,b[1]=(e[0]-c[2])/a,b[2]=(c[1]-d[0])/a}else if(c[0]>d[1]&c[0]>e[2]){var a=2*Math.sqrt(1+c[0]-d[1]-e[2]);b[3]=(d[2]-e[1])/a,b[0]=.25*a,b[1]=(c[1]+d[0])/a,b[2]=(e[0]+c[2])/a}else if(d[1]>e[2]){var a=2*Math.sqrt(1+d[1]-c[0]-e[2]);b[3]=(e[0]-c[2])/a,b[0]=(c[1]+d[0])/a,b[1]=.25*a,b[2]=(d[2]+e[1])/a}else{var a=2*Math.sqrt(1+e[2]-c[0]-d[1]);b[3]=(c[1]-d[0])/a,b[0]=(e[0]+c[2])/a,b[1]=(d[2]+e[1])/a,b[2]=.25*a}},this.axes2quat=this.pb,this.qb=function(a,b,e){var d=.5*ctx.ib(e),c=Math.sin(d);a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=Math.cos(d)},this.axisangle2quat=this.qb,this.axisangle2quat_=function(a,d){var c=.5*ctx.ib(d),b=Math.sin(c);return[a[0]*b,a[1]*b,a[2]*b,ctx.cos_(c)]},this.axisangle2quat_=this.axisangle2quat_,this.rb=function(i,j,e){var f=j[0],g=j[1],h=j[2],a=e[0],b=e[1],c=e[2],d=e[3],k=d*f+b*h-c*g,l=d*g+c*f-a*h,m=d*h+a*g-b*f,n=-a*f-b*g-c*h;i[0]=k*d+ -(n*a)+ -(l*c)- -(m*b),i[1]=l*d+ -(n*b)+ -(m*a)- -(k*c),i[2]=m*d+ -(n*c)+ -(k*b)- -(l*a)},this.sb=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j},this.mulqscalar=function(a,b,c){a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c},this.mulqscalar_=function(a,b){return[a[0]*b,a[1]*b,a[2]*b,a[3]*b]},this.tb=function(b,c,h,d,a){var e=ctx.ib(h),f=Math.cos(e)*d,g=Math.sin(e)*d;b[0]=c[0]+f*a[0]-g*a[1],b[1]=c[1]+g*a[0]+f*a[1]},this.ub=function(e,a,h,f,b){var g=ctx.ib(h),c=Math.cos(g)/f,d=Math.sin(g)/f;e[0]=c*b[0]+d*b[1]-a[0]*c-a[1]*d,e[1]=c*b[1]-d*b[0]+a[0]*d-a[1]*c},this.vb=function(a){return a<0?Math.floor(ctx.yd-1+a%ctx.yd):Math.floor(a%ctx.yd)},this.ff=function(a){return"#"+colorCompToHex_(Math.floor(255*a[0]))+colorCompToHex_(Math.floor(255*a[1]))+colorCompToHex_(Math.floor(255*a[2]))},this.tf=function(g,d,n,h,i,j){var c=ctx.f(h,g),b=ctx.f(i,g),a=ctx.r(d,n);if(c[0]< -a[0]&&b[0]< -a[0]||c[0]>a[0]&&b[0]>a[0]||c[1]< -a[1]&&b[1]< -a[1]||c[1]>a[1]&&b[1]>a[1])return!1;if(c[0]<=a[0]&&c[0]>= -a[0]&&c[1]<=a[1]&&c[1]>= -a[1])return!0;if(j<1e-6)return!1;if(b[0]<=a[0]&&b[0]>= -a[0]&&b[1]<=a[1]&&b[1]>= -a[1])return!0;var e=ctx.f(i,h);ctx.s(e,e,j);var f=[-e[1],e[0]],k=Math.abs(ctx.G(f,b));if(Math.abs(ctx.G(f,a))>=k){var l=[-d[1],d[0]];if(ctx.G(l,c)*ctx.G(l,b)<=0)return!0}else if(Math.abs(ctx.G(f,[a[0],-a[1]]))>=k){var m=[d[1],d[0]];if(ctx.G(m,c)*ctx.G(m,b)<=0)return!0}return!1},this.uf=function(g,d,n,h,i,j,o){var c=ctx.f(h,g),b=ctx.f(i,g),a=ctx.r(d,n);if(j<1e-6||c[0]< -a[0]&&b[0]< -a[0]||c[0]>a[0]&&b[0]>a[0]||c[1]< -a[1]&&b[1]< -a[1]||c[1]>a[1]&&b[1]>a[1])return!1;var e=ctx.f(i,h);ctx.s(e,e,j);var f=[-e[1],e[0]],k=Math.abs(ctx.G(f,b));if(o){if(Math.abs(ctx.G(f,a))>=k){var l=[-d[1],d[0]];if(ctx.G(l,c)*ctx.G(l,b)<=0)return!0}}else if(Math.abs(ctx.G(f,[a[0],-a[1]]))>=k){var m=[d[1],d[0]];if(ctx.G(m,c)*ctx.G(m,b)<=0)return!0}return!1},this.wb=function(a,d,e,f){var b=3*(e*ctx.yd+d),c=ctx.zd[f];a[0]=c.getUint8(b),a[1]=c.getUint8(b+1),a[2]=c.getUint8(b+2)},this.xb=function(l,h){if(null==ctx.zd){ctx.W(l,128,128,128);return}var m=h[0]*ctx.yd,n=h[1]*ctx.yd,o=h[2]*ctx.yd,i=Math.floor(m),j=Math.floor(n),k=Math.floor(o),E=m-i,p=n-j,a=o-k,b=ctx.vb(i),c=ctx.vb(i+1),d=ctx.vb(j),e=ctx.vb(j+1),f=ctx.vb(k),g=ctx.vb(k+1),q=[],r=[],s=[],t=[],u=[],v=[],w=[],x=[];ctx.wb(q,b,d,f),ctx.wb(r,b,d,g),ctx.wb(s,b,e,f),ctx.wb(t,b,e,g),ctx.wb(u,c,d,f),ctx.wb(v,c,d,g),ctx.wb(w,c,e,f),ctx.wb(x,c,e,g);var y=[],z=[],A=[],B=[];ctx.ab(y,q,r,a),ctx.ab(z,s,t,a),ctx.ab(A,u,v,a),ctx.ab(B,w,x,a);var C=[],D=[];ctx.ab(C,y,z,p),ctx.ab(D,A,B,p),ctx.ab(l,C,D,E)},this.ImageDesc=function(a,b,c,d,e){this.image=a,this.x=b,this.y=c,this.width=d,this.height=e},this.RenderCall=function(a,b,c){this.startIndex=a,this.numIndices=b,this.renderStyleIndex=c},this.SubRect=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d},this.Camera2D=function(){},this.Camera2D.prototype.tb=function(a,b){return!0},this.Camera3D=function(a,b){this.Qd=ctx.r(a,.5),this.z=-(.5*a[0])/Math.tan(ctx.ib(.5*b))},this.Camera3D.prototype.transform=function(a,b){if(a[2]<this.z)return!1;var c=-this.z/(a[2]-this.z);return ctx.a(a,ctx.r(ctx.f(a,this.Qd),c),this.Qd),ctx.q(b,b,c),!0},this.zd=null,this.yd=0,this.initializeNoise=function(a,c,d){if(a||alert("path should be defined"),null!=this.zd){c();return}(null==a|| void 0==a)&&(a=this.defaultPath);var b=new XMLHttpRequest;b.open("GET",a+"neutrinoparticles.noise.bin",!0),b.responseType="arraybuffer",b.ctx=this,b.onreadystatechange=function(){if(4==b.readyState){if(b.status>=200&&b.status<300||304==b.status){var g=b.response,f=b.ctx,a=new DataView(g,0,4).getUint32(0,!0);f.zd=[],f.yd=a;for(var e=0;e<a;++e)f.zd[e]=new DataView(g,4+3*a*a*e);c&&c()}else d&&d()}},b.send()},this.NoiseGenerator=function(){for(var g,h,i,j,k,l,m,n,o=function(b,c,d,e,a){return .5*(2*c+(-b+d)*a+(2*b-5*c+4*d-e)*a*a+(-b+3*c-3*d+e)*(a*a*a))},p=function(a,b,c,d,e){return[o(a[0],b[0],c[0],d[0],e),o(a[1],b[1],c[1],d[1],e),o(a[2],b[2],c[2],d[2],e)]},q=function(a,b,c){return a<b?b:a>c?c:a},b=64,r=[],s=[],t=new ctx.taus88(120),u=function(){return t.rand()},v=.7,w=1.2,d=b,e=0,x=0,a=d>>>1;a>0;a>>>=1){var c=Math.floor(b/a);e+=c*c}var f={INITIAL_FILL:0,MIX_STEP_INIT:1,MIX_STEP_PROCESS:2,SCALING:3,DATA_VIEWS:4,FINISHED:5},y={INIT:.01,MIX:.9,SCALING:.95,DATA_VIEWS:1},z=f.INITIAL_FILL;this.progress=0;var A=function(){for(var a=0;a<b;++a)for(var e=r[a]=[],c=0;c<b;++c)for(var g=e[c]=[],d=0;d<b;++d)g[d]=[0,0,0];z=f.MIX_STEP_INIT,this.progress=y.INIT},B=function(){g=d>>>1,j=(i=Math.floor((h=b)/g))*i,k=Math.max(i-1,1),l=i*i*i,m=0,n=0;for(var a=0;a<l;++a)s[a]=[],s[a][2]=2*u()-1,s[a][1]=2*u()-1,s[a][0]=2*u()-1;z=f.MIX_STEP_PROCESS},C=function(){for(var H=0;H<i;++H)for(var b=m-1>>>0&k,c=m>>>0&k,h=m+1>>>0&k,l=m+2>>>0&k,o=n-1>>>0&k,t=n>>>0&k,u=n+1>>>0&k,A=n+2>>>0&k,B=H-1>>>0&k,C=H>>>0&k,D=H+1>>>0&k,E=H+2>>>0&k,a=[[[s[b*j+o*i+B],s[b*j+o*i+C],s[b*j+o*i+D],s[b*j+o*i+E]],[s[b*j+t*i+B],s[b*j+t*i+C],s[b*j+t*i+D],s[b*j+t*i+E]],[s[b*j+u*i+B],s[b*j+u*i+C],s[b*j+u*i+D],s[b*j+u*i+E]],[s[b*j+A*i+B],s[b*j+A*i+C],s[b*j+A*i+D],s[b*j+A*i+E]]],[[s[c*j+o*i+B],s[c*j+o*i+C],s[c*j+o*i+D],s[c*j+o*i+E]],[s[c*j+t*i+B],s[c*j+t*i+C],s[c*j+t*i+D],s[c*j+t*i+E]],[s[c*j+u*i+B],s[c*j+u*i+C],s[c*j+u*i+D],s[c*j+u*i+E]],[s[c*j+A*i+B],s[c*j+A*i+C],s[c*j+A*i+D],s[c*j+A*i+E]]],[[s[h*j+o*i+B],s[h*j+o*i+C],s[h*j+o*i+D],s[h*j+o*i+E]],[s[h*j+t*i+B],s[h*j+t*i+C],s[h*j+t*i+D],s[h*j+t*i+E]],[s[h*j+u*i+B],s[h*j+u*i+C],s[h*j+u*i+D],s[h*j+u*i+E]],[s[h*j+A*i+B],s[h*j+A*i+C],s[h*j+A*i+D],s[h*j+A*i+E]]],[[s[l*j+o*i+B],s[l*j+o*i+C],s[l*j+o*i+D],s[l*j+o*i+E]],[s[l*j+t*i+B],s[l*j+t*i+C],s[l*j+t*i+D],s[l*j+t*i+E]],[s[l*j+u*i+B],s[l*j+u*i+C],s[l*j+u*i+D],s[l*j+u*i+E]],[s[l*j+A*i+B],s[l*j+A*i+C],s[l*j+A*i+D],s[l*j+A*i+E]]]],I=0;I<g;++I)for(var F=I/g,N=m*g+I,G=[[p(a[0][0][0],a[1][0][0],a[2][0][0],a[3][0][0],F),p(a[0][0][1],a[1][0][1],a[2][0][1],a[3][0][1],F),p(a[0][0][2],a[1][0][2],a[2][0][2],a[3][0][2],F),p(a[0][0][3],a[1][0][3],a[2][0][3],a[3][0][3],F)],[p(a[0][1][0],a[1][1][0],a[2][1][0],a[3][1][0],F),p(a[0][1][1],a[1][1][1],a[2][1][1],a[3][1][1],F),p(a[0][1][2],a[1][1][2],a[2][1][2],a[3][1][2],F),p(a[0][1][3],a[1][1][3],a[2][1][3],a[3][1][3],F)],[p(a[0][2][0],a[1][2][0],a[2][2][0],a[3][2][0],F),p(a[0][2][1],a[1][2][1],a[2][2][1],a[3][2][1],F),p(a[0][2][2],a[1][2][2],a[2][2][2],a[3][2][2],F),p(a[0][2][3],a[1][2][3],a[2][2][3],a[3][2][3],F)],[p(a[0][2][0],a[1][3][0],a[2][3][0],a[3][3][0],F),p(a[0][2][1],a[1][3][1],a[2][3][1],a[3][3][1],F),p(a[0][2][2],a[1][3][2],a[2][3][2],a[3][3][2],F),p(a[0][2][3],a[1][3][3],a[2][3][3],a[3][3][3],F)]],J=0;J<g;++J)for(var K=J/g,O=n*g+J,Q=p(G[0][0],G[1][0],G[2][0],G[3][0],K),R=p(G[0][1],G[1][1],G[2][1],G[3][1],K),S=p(G[0][2],G[1][2],G[2][2],G[3][2],K),T=p(G[0][3],G[1][3],G[2][3],G[3][3],K),L=0;L<g;++L){var U=L/g,P=H*g+L,V=p(Q,R,S,T,U),M=ctx.d(ctx.v(V,v),r[N][O][P]),W=[q(M[0],-1,1),q(M[1],-1,1),q(M[2],-1,1)];r[N][O][P]=W}x++,this.progress=y.INIT+(y.MIX-y.INIT)*(x/e),++n>=i&&(n=0,++m>=i&&(m=0,d=g,v=Math.pow(v,w),d<=1?(z=f.SCALING,this.progress=y.MIX):z=f.MIX_STEP_INIT))},D=function(){for(var c=[-1,-1,-1],d=[.5,.7,1],e=0;e<b;++e)for(var i=r[e],g=0;g<b;++g)for(var j=i[g],h=0;h<b;++h){var a=j[h];a[0]=ctx.X(c[0],d[0],.5*a[0]+.5),a[1]=ctx.X(c[1],d[1],.5*a[1]+.5),a[2]=ctx.X(c[2],d[2],.5*a[2]+.5)}z=f.DATA_VIEWS,this.progress=y.SCALING},E=function(){ctx.yd=b,ctx.zd=[];for(var a=0;a<b;++a){for(var i=r[a],j=new ArrayBuffer(b*b*3),c=new DataView(j),d=0;d<b;++d)for(var k=i[d],e=0;e<b;++e){var g=k[e],h=(d*b+e)*3;c.setUint8(h+0,Math.floor(q(256*(.5*g[0]+.5)-.5,0,255))),c.setUint8(h+1,Math.floor(q(256*(.5*g[1]+.5)-.5,0,255))),c.setUint8(h+2,Math.floor(q(256*(.5*g[2]+.5)-.5,0,255)))}ctx.zd[a]=c}z=f.FINISHED,this.progress=y.DATA_VIEWS};this.step=function(){switch(z){case f.INITIAL_FILL:A.call(this);break;case f.MIX_STEP_INIT:B.call(this);break;case f.MIX_STEP_PROCESS:C.call(this);break;case f.SCALING:D.call(this);break;case f.DATA_VIEWS:E.call(this)}return z==f.FINISHED}},this.cf=document.createElement("canvas"),this.cf.width=0,this.cf.height=0,this.bf=this.cf.getContext("2d"),this.af=function(a,b){(this.cf.width<a||this.cf.height<b)&&(this.cf.width=a,this.cf.height=b,this.bf=this.cf.getContext("2d"))},this.effects=[],this.loadEffect=function(effectFilePath,onSuccessFunc,onFailFunc){if(void 0!=this.effects[effectFilePath]){var effectModel=this.effects[effectFilePath];if(effectModel instanceof Array){effectModel[effectModel.length]=[onSuccessFunc,onFailFunc];return}onSuccessFunc(effectModel);return}this.effects[effectFilePath]=[[onSuccessFunc,onFailFunc]];var request=new XMLHttpRequest;request.open("GET",effectFilePath,!0),request.responseType="text",request.ctx=this,request.onreadystatechange=function(){if(4==request.readyState){var callbacks=this.ctx.effects[effectFilePath];if(request.status>=200&&request.status<300||304==request.status){var evalText,effectModel=eval("(function(ctx) {\n"+request.responseText+"\nreturn new NeutrinoEffect(ctx);\n})(this.ctx);");this.ctx.effects[effectFilePath]=effectModel,callbacks.forEach(function(a){a[0](effectModel)})}else callbacks.forEach(function(a){a[1]()})}},request.send()},this.removeEffect=function(a){delete this.effects[a]}}exports.Context=Context,Object.defineProperty(exports,"__esModule",{value:!0})})